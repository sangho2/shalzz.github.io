<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>
  Trusting a Self-signed SSL Certificate
</title>

    
    <meta name="description" content="When connecting to a server which has setup their SSL encryption with a self-signed certificate
through a Java or an android app, you&#x27;ll get an SSLException since their certificate isn&#x27;t signed
by a Certificate Authorities (CA) which is a 3rd party who is trusted by everyone.

javax.net.ssl.SSLException: Not trusted server certificate exception

If you have access to the server or know the site admin, get them to buy a CA signed SSL certificate.
But in case that is not possible or feasible we can one thing we can do is
configure our HTTP client library to just not verify the site hostname with the certificate.
But then again that is not a good solution and defeats the whole purpose of encryption.
">

    
        <meta name="keywords" content="web, android, technology, docker, javascript, java, python, blog, computer engineering, shaleen jain, shalzz, shaleen, jain, C/C++, rust, C, C++, GO-lang, java, android, SSL, SSLException, self-signed">
    


    
        <meta name="author" content="Shaleen Jain">

        <link rel="author" href="https:&#x2F;&#x2F;twitter.com&#x2F;shalzzj">
        
            <link href="https:&#x2F;&#x2F;shaleenjain.com&#x2F;blog&#x2F;ssl-socket-facotry-java&#x2F;" rel="canonical">
        
         <link rel="alternate" type="application/atom+xml" title="RSS" href="https://shaleenjain.com/atom.xml">
    

    
    
        <meta name="twitter:site" content="@shalzzj">
        <meta name="twitter:creator" content="@shalzzj">

        <meta property="og:type" content="article">
        
            <meta property="og:url" content="https:&#x2F;&#x2F;shaleenjain.com&#x2F;blog&#x2F;ssl-socket-facotry-java&#x2F;">
        

        
        <meta property="og:description" content="Personal and technical musings">
        
    
    <meta name="twitter:title" content="Trusting a Self-signed SSL Certificate &mdash; Shaleen Jain">
    <meta property="og:title" content="Trusting a Self-signed SSL Certificate">


    
    


    
        <link rel="apple-touch-icon" sizes="180x180" href="https:&#x2F;&#x2F;shaleenjain.com&#x2F;icons&#x2F;apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https:&#x2F;&#x2F;shaleenjain.com&#x2F;icons&#x2F;favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https:&#x2F;&#x2F;shaleenjain.com&#x2F;icons&#x2F;favicon-16x16.png">
        <link rel="manifest" href="https:&#x2F;&#x2F;shaleenjain.com&#x2F;icons&#x2F;manifest.json">
        <link rel="mask-icon" href="https:&#x2F;&#x2F;shaleenjain.com&#x2F;icons&#x2F;safari-pinned-tab.svg">
        <link rel="shortcut icon" href="https:&#x2F;&#x2F;shaleenjain.com&#x2F;icons&#x2F;favicon.ico">
        <meta name="msapplication-config" content="https:&#x2F;&#x2F;shaleenjain.com&#x2F;icons&#x2F;browserconfig.xml">
        <meta name="theme-color" content="#ffffff">
    

    

    
        <style>
            /*! normalize.css v3.0.2 | MIT License | git.io/normalize */html{font-family:"sans-serif";-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{font-size:2em;margin:0.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:0px}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}html{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}.image-row{display:flex;flex-flow:row wrap;align-items:center;padding:0 4px}.image-column{flex:50%;max-width:50%;padding:0 4px;border-radius:8px;width:100%;height:auto}@media screen and (max-width: 42em){.image-column{flex:100%;max-width:100%}}.text-center{text-align:center}.text-right{text-align:right}.fa-social-icons{font-size:2rem;margin-top:-1rem}.fa-social-icons a{border:0;margin-right:0.1rem}.fa-social-icons a:last-child{margin-right:0}.masthead,.content,.footer{max-width:42em;margin-left:auto;margin-right:auto}.masthead:after,.post:after,.related:after,.recent:after,.page:after,.comments:after,.index:after{display:block;content:"";width:150px;height:1px;margin:2rem auto;background-color:#c4c4c4}.related .related-title,.related .recent-title,.recent .related-title,.recent .recent-title{margin-top:0}.masthead{margin-bottom:2rem}.masthead a{color:#111}.masthead .masthead-title{margin:0;padding:0}.masthead .masthead-title a{text-decoration:none;border:0}@media (min-width: 42em){.masthead .masthead-title{float:left}}.masthead .masthead-nav{display:inline-block;padding-left:0;margin-bottom:0}.masthead .masthead-nav a{text-decoration:none;border:0}.masthead .masthead-nav a+a{margin-left:0.6rem}@media (min-width: 42em){.masthead{padding-top:1rem;text-align:right}}.footer{margin-bottom:1rem;text-align:center}.footer a[rel="license"]:first-child{display:inline-block;margin:0;padding:0;border:0;text-decoration:none}.footer .icon-square{color:transparent}.footer .icon-square:hover{color:#252525}.footer .fa-stack-1x{color:black}.footer p>span{font-size:110%}.footer p>span a{padding:2px;border:0}.footer p>span i:hover{color:white}.footer p p:last-child{margin-bottom:0}.posts{padding-bottom:1rem}.posts .posts-item{margin-bottom:1rem}@media (min-width: 42em){.posts .posts-item{margin-bottom:0.2rem}}.posts a{border:0}.posts time{display:block;color:#848484}@media (min-width: 42em){.posts time{margin-top:2px;float:right}}.next,.previous{font-weight:600;font-size:20px;transition:transform 0.3s ease-out}.next{float:right}.next:hover{transform:translateX(4px)}.previous{float:left}.previous:hover{transform:translateX(-4px)}html,body{margin:0}html{font-family:"Lora","sans-serif";font-size:18px;line-height:1.6}@media (min-width: 42em){html{font-size:20px}}body{padding:2rem 1.5rem;color:#444;background-color:#fff;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a{color:#afd700;text-decoration:none;border-bottom:1px solid #afd700}a:hover,a:focus{background-color:#afd700;color:white}a strong{color:inherit}img{display:block;max-width:100%;margin:0 0 1rem;border-radius:5px}table{margin-bottom:1rem;width:100%;font-size:85%;border:1px solid #c4c4c4;border-collapse:collapse}.js-file-line-container td{border:none}td,th{padding:.25rem .5rem;border:1px solid #c4c4c4}th{text-align:left}tbody tr:nth-child(even) td,tbody tr:nth-child(even) th{background-color:#fff}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#fafafa}

        </style>
    

    
      <style>
        /* latin */
        @font-face {
          font-family: 'Lora';
          font-style: italic;
          font-weight: 400;
          font-display: swap;
          src: url(https://shaleenjain.com/fonts/0QI8MX1D_JOuMw_hLdO6T2wV9KnW-MoFoq92nA.woff2) format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
        /* latin */
        @font-face {
          font-family: 'Lora';
          font-style: normal;
          font-weight: 400;
          font-display: swap;
          src: url(https://shaleenjain.com/fonts/0QI6MX1D_JOuGQbT0gvTJPa787weuxJBkq0.woff2) format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
        /* latin */
        @font-face {
          font-family: 'Lora';
          font-style: normal;
          font-weight: 700;
          font-display: swap;
          src: url(https://shaleenjain.com/fonts/0QI6MX1D_JOuGQbT0gvTJPa787z5vBJBkq0.woff2) format('woff2');
          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
      </style>
    
  </head>

  <body>
    
        <link rel="stylesheet" href="https:&#x2F;&#x2F;shaleenjain.com&#x2F;style.css">
    

    
        <header class="masthead">
          <h3 class="masthead-title">
            <a href="https:&#x2F;&#x2F;shaleenjain.com">Shaleen Jain</a>
          </h3>
          <nav class="masthead-nav">
            
            <a href="&#x2F;blog" class="nav-item">Blog</a>
            
          </nav>
        </header>
    


    <main class="content">
        

<article class="post">
  <header class="post-header">
    <time datetime="2013-12-27" class="post-date">
        27 Dec 2013
    </time>
        
        <small>
            Â· 
    <span class="reading-time" title="Estimated read time">
      
        1 min read
      
    </span>

        </small>
    <h1 class="post-title">Trusting a Self-signed SSL Certificate</h1>
  </header>

  <p>When connecting to a server which has setup their SSL encryption with a self-signed certificate
through a Java or an android app, you'll get an SSLException since their certificate isn't signed
by a Certificate Authorities (CA) which is a 3rd party who is trusted by everyone.</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">javax.net.ssl.SSLException: Not trusted server certificate exception
</span></code></pre>
<p>If you have access to the server or know the site admin, get them to buy a CA signed SSL certificate.</p>
<p>But in case that is not possible or feasible we can one thing we can do is
configure our HTTP client library to just not verify the site hostname with the certificate.
But then again that is not a good solution and defeats the whole purpose of encryption.</p>
<span id="continue-reading"></span>
<p>A more elegant solution is to tell the client library to explicitly trust a certificate.
We'll have to manually get a copy of the site's self-signed certificate that we can use
to tell our client to trust.</p>
<p>Java has a couple of HTTP clients, mainly:</p>
<ul>
<li>Apache HTTP client</li>
<li>HttpUrlConnection</li>
</ul>
<p>You'll find that when using Apache Http client we'll have to create a custom SSLSocketFactory to implement the above 
functionality.
And for HttpUrlConnection set a custom SSLSocket to the connection as described at <a href="https://developer.android.com/training/articles/security-ssl.html">developer.android.com</a>. </p>
<p>Here is a reference implementation that does just that.</p>
<div >
    <script src="https:&#x2F;&#x2F;gist.github.com&#x2F;shalzz&#x2F;8125772.js"></script>
</div>
<h4 id="for-httpurlconnection"><a class="zola-anchor" href="#for-httpurlconnection" aria-label="Anchor link for: for-httpurlconnection">ðŸ”—</a>
For HttpURLConnection</h4>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#859900;">MySSLSocketFactory</span><span style="color:#657b83;"> sslf = </span><span style="color:#b58900;">null</span><span style="color:#657b83;">;
</span><span style="color:#859900;">try </span><span style="color:#657b83;">{
    </span><span style="color:#859900;">KeyStore</span><span style="color:#657b83;"> ks = </span><span style="color:#859900;">MySSLSocketFactory</span><span style="color:#657b83;">.</span><span style="color:#b58900;">getKeystoreOfCA</span><span style="color:#657b83;">(</span><span style="color:#b58900;">getResources</span><span style="color:#657b83;">().</span><span style="color:#b58900;">openRawResource</span><span style="color:#657b83;">(</span><span style="color:#859900;">R</span><span style="color:#657b83;">.raw.myCert));
    sslf = </span><span style="color:#859900;">new MySSLSocketFactory</span><span style="color:#657b83;">(ks);
} </span><span style="color:#859900;">catch </span><span style="color:#657b83;">(</span><span style="color:#859900;">Exception </span><span style="color:#268bd2;">e</span><span style="color:#657b83;">) {
    e.</span><span style="color:#b58900;">printStackTrace</span><span style="color:#657b83;">();
} </span><span style="color:#859900;">finally </span><span style="color:#657b83;">{
    sslf.</span><span style="color:#b58900;">fixHttpsURLConnection</span><span style="color:#657b83;">();
}
</span></code></pre>
<p>Here we create a <code>Keystore</code> containing our certificate, in this case <code>myCert</code>.
Which we then use to get an instance of <code>MySSLSocketFactory</code> and then call its non static <code>fixHttpsURLConnection()</code> method.
This sets the SSLSocketFactory created as the default SSLSocketFactory for HttpURLConnection. </p>
<h4 id="for-apache-http-client"><a class="zola-anchor" href="#for-apache-http-client" aria-label="Anchor link for: for-apache-http-client">ðŸ”—</a>
For Apache Http Client</h4>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#859900;">MySSLSocketFactory</span><span style="color:#657b83;"> sslf = </span><span style="color:#b58900;">null</span><span style="color:#657b83;">;
</span><span style="color:#859900;">DefaultHttpClient</span><span style="color:#657b83;"> client  = </span><span style="color:#b58900;">null </span><span style="color:#657b83;">;
</span><span style="color:#859900;">try </span><span style="color:#657b83;">{
    </span><span style="color:#859900;">KeyStore</span><span style="color:#657b83;"> ks = </span><span style="color:#859900;">MySSLSocketFactory</span><span style="color:#657b83;">.</span><span style="color:#b58900;">getKeystoreOfCA</span><span style="color:#657b83;">(</span><span style="color:#d33682;">this</span><span style="color:#657b83;">.</span><span style="color:#b58900;">getResources</span><span style="color:#657b83;">().</span><span style="color:#b58900;">openRawResource</span><span style="color:#657b83;">(</span><span style="color:#859900;">R</span><span style="color:#657b83;">.raw.myCert));
    client  = </span><span style="color:#859900;">MySSLSocketFactory</span><span style="color:#657b83;">.</span><span style="color:#b58900;">getNewHttpClient</span><span style="color:#657b83;">(ks);
} </span><span style="color:#859900;">catch </span><span style="color:#657b83;">(</span><span style="color:#859900;">Exception </span><span style="color:#268bd2;">e</span><span style="color:#657b83;">) {
    e.</span><span style="color:#b58900;">printStackTrace</span><span style="color:#657b83;">();
}
</span></code></pre>
<p>In this case we get a <code>DefaultHttpClient</code> created with the <code>KeyStore</code> containing our Certificates.</p>
<blockquote>
<p>Originally posted at <a href="https://coding-euphoria.blogspot.in/2013/12/custom-sslsocketfactory-that-trusts.html">coding-euphoria.blogspot.in</a><br />
Edited and updated on 20/07/2017</p>
</blockquote>

</article>


<div>
 Liked this article? Buy me a beer on the Bitcoin Lightning Network
<div id="tippin-button" data-dest="shalzzj"></div>
<script src="https://tippin.me/buttons/tip.js" type="text/javascript"></script>
<br/>
</div>



  <p>Got any questions or comments? Drop me a message on <a href="https:&#x2F;&#x2F;twitter.com&#x2F;shalzzj" rel="nofollow">Twitter @shalzzj</a> or comment below.</p>




<div class="comments" id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https:&#x2F;&#x2F;shaleenjain.com&#x2F;blog&#x2F;ssl-socket-facotry-java&#x2F;';
        this.page.identifier = 'blog/ssl-socket-facotry-java';
        this.page.title = 'Trusting a Self-signed SSL Certificate';
    };
    var disqus_shortname = 'shalzz';
    (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        dsq.setAttribute('data-timestamp', +new Date());
        (document.head || document.body).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





    </main>

    
        <footer class="footer">
          <p><small>
            This work is licensed under the <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
            CC BY-SA 4.0</a> license.
          <br/>
          <a href="https://shaleenjain.com/atom.xml">RSS Feed</a> â€¢
          <a href="https://shaleenjain.com/donate/">Support my work</a>!
          </small></p>
        </footer>
    

    
    
        <script data-goatcounter="https://personal.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    
    
  </body>
</html>
